@model ServerApp.Pages.App.Meal_Plans.MealViewModel

@{ 
    var recipe = @Model.Recipes.FirstOrDefault();
    var recipeLocation = recipe?.OtherSource?.Title
        ?? (recipe?.BookSource?.Title is { } ? $"{recipe.BookSource.Title} page {recipe.BookSource.Page}" : null)
        ?? "";
    var url = recipe?.WebSource?.Url.ToString() ?? "";
    var urlTitle = recipe?.WebSource?.Title ?? "";
    var date = Model.Date;
    var startDate = Model.StartDate;
}


<div class="meal-edit" id=_@date>
    <p>@date</p>
    <h2 data-ref=name,title|text title="@recipe?.Name">@recipe?.Name</h2>
    <p>
        <small>
            <span data-ref=recipeLocation,title|text title="@recipeLocation">@recipeLocation</span>
            <a data-ref=url,href;urlTitle,title|text href="@url" title="@urlTitle">@urlTitle</a>
        </small>
    </p>
    <div>
        <form class=inline method=post >
            <button
                    asp-page-handler="cancel"
                    asp-route-id="@date"
                    asp-route-startDate=@startDate
                    hx-post="/app/meal-plans/edit?handler=cancel&startDate=@startDate&id=@Model.Date"
                    hx-target="#_@Model.Date"
                    >Cancel</button>&nbsp;
            <button
                    asp-page-handler="previous"
                    asp-route-id="@date"
                    asp-route-startDate=@startDate
                    hx-post="/app/meal-plans/edit?handler=previous&startDate=@startDate&id=@Model.Date"
                    hx-target="#_@Model.Date"
                    >&laquo; Back</button>&nbsp;
            @*<button formmethod=get formaction="/app/recipes/search?date=@date" asp-route-startDate=@startDate>Search</button>&nbsp;*@
            <button
                    asp-page-handler="next"
                    asp-route-id="@date"
                    asp-route-startDate=@startDate
                    hx-post="/app/meal-plans/edit?handler=next&startDate=@startDate&id=@Model.Date"
                    hx-target="#_@Model.Date"
                    >Next &raquo;</button>
        </form>
    </div>
</div>
